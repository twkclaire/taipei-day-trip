<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Booking</title>
  <link rel="stylesheet" href="/static/booking.css">
  <link rel="stylesheet" href="/static/signin.css" />
</head>
<body>
  <header>
    <div class="flex-view">
      <a href="/static/index.html" class="left">
        <span class="title">台北一日遊</span>
      </a>
      <div class="right">
          <div class="menu">
            <a class="item" id="booktripItem">預定行程</a>
            <a class="item hidden" id="signinItem">登入</a> 
            <a class="item hidden" id="signupItem">/註冊</a>
            <a class="item hidden" id="signoutItem" onclick="deleteToken()">/登出系統</a>
          </div>
      </div>
    </div>
  </header>

  <dialog class="popup-wrap" id="signupd">
    <div class="signup">
      <form class="pop-form-wrap" onsubmit="registerUser(event)">
        <div class="pop-form-title">註冊會員帳號</div>
        <span class="close" id="signupclose">
          <img src="/static/image/close.svg" />
        </span>
        <input placeholder="輸入姓名" class="name-r" id="namere" required />
        <input placeholder="輸入電子郵件" class="email-r" id="emailre" type="email"required />
        <input
          placeholder="輸入密碼"
          class="password-r"
          id="passwordre"
          type="password"
          required
        />
        <button class="sign-up" type="submit">
          註冊新帳號
        </button>
        <div class="note" id="notere">
          已經有帳戶了？
          <a class="clickhere" id="signinclick" onclick="signIn()">
            點此登入
          </a>
        </div>
        <div class="result" id="resultre"></div>
      </form>
    </div>
  </dialog>

  <dialog class="popup-wrap" id="signind">
    <div class="signin">
      <form class="pop-form-wrap" onsubmit="userSignIn(event)">
        <div class="pop-form-title">登入會員帳號</div>
        <span class="close" id="signinclose">
          <img src="/static/image/close.svg" />
        </span>
        <input placeholder="輸入電子信箱" class="email" id="email" type="email" required />
        <input
          placeholder="輸入密碼"
          class="password"
          id="password"
          type="password"
          required
        />
        <button class="log-in" type="submit">
          登入帳戶
        </button>
        <div class="note">
          還沒有帳戶？
          <a class="clickhere" id="signupclick" onclick="signUp()">
            點此註冊
          </a>
        </div>
        <div class="result" id="resultsign"></div>
      </form>
    </div>
  </dialog>


  <div class="no-booking-wrap hidden-content" id="no-booking-wrap">
    <div class="itinerary-no-bookingwrap">
      <div class="itinerary-intro" id="itinerary-intro-no-booking"></div>
      <p class="no-booking-text" id="no-booking-text">目前沒有任何待預訂的行程</p>
      
    </div>
  </div>  
  <div class="booking-wrap hidden-content" id="booking-wrap">
    <div class="itinerary-wrap">
      <div class="itinerary-intro" id="itinerary-intro"></div>
      <div class="itinerary-img-text-wrap" id="itinerary-img-text-wrap">
        <img class="itinerary-img" id="itinerary-img">
        <div class="itinerary-text" id="itinerary-text">
          <!-- <p class="itinerary-title">台北一日遊：平安鐘</p>
          <p>日期：2021-04-23</p>
          <p>時間：早上 9 點到下午 4 點</p>
          <p>費用：新台幣 2000 元</p>
          <p>地點：臺北市 大安區忠孝東路4段</p> -->
        </div>
        <div class="delete-wrap">
          <img class="danger" id="danger" src="/static/image/delete.svg">
        </div>

      </div>
    </div>
    <hr>

    <div class="contact-form" id="contact-form">
      <div class="contact-text">您的聯絡資訊</div>
      <div>聯絡姓名：<input></div>
      <div>連絡信箱：<input></div>
      <div>手機號碼：<input></div>
      <p class="contact-warn">請保持手機暢通，準時到達，導覽人員將用手機與您聯繫，務必留下正確的聯絡方式。</p>
    </div>

    <hr>
    <div class="card-info" id="card-info">
      <div class="card-text">信用卡付款資訊</div>
      <div>卡片號碼：<input placeholder="**** **** **** **** " type="tel" maxlength="16"></div>
      <div>過期時間：<input placeholder="MM/YY" type="tel"></div>
      <div>驗證密碼：<input placeholder="CVV" type="tel" pattern="\d*" maxlength="3"></div>
    </div>

    <hr>
    <div class="submit-wrap">
      <div class="submit" id="submit-booking">
        <p class="submit-text" id="submit-text"></p>
        <button class="submit-btn">確認訂購並付款</button>
      </div>
    </div>
  </div>

  <footer id="footer">
    <div class="footer-text">COPYRIGHT © 2021 台北一日遊</div>
  </footer>
  <script src="/static/signin.js"></script>
  <script src="/static/booking.js"></script>

  <!-- <script>
    var main=""
    var submitPrice=""
    var itineraryIntro=document.getElementById('itinerary-intro');
    var itineraryIntroNoBooking=document.getElementById('itinerary-intro-no-booking');
    const submitText=document.getElementById('submit-text');
    const bookingWrap=document.getElementById('booking-wrap');
    const noBookingWrap=document.getElementById('no-booking-wrap');
    const contactForm=document.getElementById('contact-form');
    const icardInfo=document.getElementById('card-info');
    const submitWrap=document.getElementById('submit-wrap');
    const noBookingText=document.getElementById('no-booking-tex');
    const danger=document.getElementById('danger');
    const footer=document.getElementById('footer');

    danger.addEventListener('click', () => {
      let token = localStorage.getItem("token");
      console.log("I clicked delete");
      console.log('token');

      fetch("/api/booking", {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` },
      })
        .then((resp) => {
          return resp.json().then((data) => {
            if (!resp.ok) {
              throw new Error(`HTTP error! status: ${resp.status}, message: ${data.detail}`);
            }
            return data;
          });
        })
        .then((data) => {
          console.log("delete succesful")
          console.log(data);
          location.reload();
        })
        .catch((error) => {
          console.error("Error:", error);
          console.log("something is wrong")
        });
    });

    function getBooking() {
      let token = localStorage.getItem("token");
      console.log(token);
      if (token == null){
        console.log("log in please")
        window.location.href="/"
      }else{
        fetch("/api/booking",{
          method:"GET",
          headers:{ Authorization: `Bearer ${token}` }, 
        })
            .then((resp) => {
            return resp.json().then((data) => {
              if (!resp.ok) {
                throw new Error(
                  `HTTP error! status: ${resp.status}, message: ${data.detail}`
                );
              }
              return data;
            });
          })
            .then((data) => {
                console.log(data)
                
                if (!data.data){
                  noBookingWrap.classList.remove('hidden-content');
                  itineraryIntroNoBooking.innerHTML=`您好，${userName}，待預訂的行程如下：`;
                  footer.style.height="100%";
                  
                  
                  console.log("nobooking");
                }else{
                  console.log("there is a booking");
                  bookingWrap.classList.remove('hidden-content');
                  const name=data.data.attraction.name;
                  const address=data.data.attraction.address;
                  const time=data.data.time; 
                  const date=data.data.date;
                  const price=data.data.price;
                  const img= data.data.attraction.image;
                  if (time=='morning'){
                    booktime='早上 9 點到中午 12 點'
                  } else{
                    booktime='中午 12 點到中午 4 點'
                  }
                  console.log(name,address, time, date, price);
                  let itineraryText=document.getElementById("itinerary-text");
                  let itineraryImg=document.getElementById("itinerary-img");
                  itineraryImg.src=img;
                  // itineraryIntroNoBooking.innerHTML=`您好，${userName}，待預訂的行程如下：`
                  itineraryIntro.innerHTML=`您好，${userName}，待預訂的行程如下：`
                  main += `
                            <p class="itinerary-title">台北一日遊：${name}</p>
                            <p><b>日期：</b>${date}</p>
                            <p><b>時間：</b>${booktime}</p> 
                            <p><b>費用：</b>新台幣${price}元</p>
                            <p><b>地點：</b>${address}</p>
                          `;
                  itineraryText.innerHTML=main;
                  submitPrice +=`<p>總價：新台幣${price}元<p>`;
                  submitText.innerHTML=submitPrice;  


                }

            })
            .catch((error) => {
              console.error("Error:", error);

          });
        }
      

    }
    document.addEventListener('userSignedIn', getBooking);

  </script>    -->
</body>
</html>